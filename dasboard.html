<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- log -->
  <link rel="shortcut icon" href="./images/logo.png" type="image/x-icon">
  <title>Registration</title>
  <!-- Flowbite CDN -->
  <link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet" />
  <!-- bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

  <!-- Font-awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
    integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <title>Dasboard</title>
</head>

<body>
  <!-- navbar -->
  <nav class="bg-blue-200 border-gray-200">
    <div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl p-4">
      <a href="#" class="flex items-center space-x-3 rtl:space-x-reverse">
        <img src="./images/logo.png" class="h-10" alt="Logo" />
        <span class="self-center text-2xl text-black-500 font-semibold whitespace-nowrap">Flowbite</span>
      </a>
      <div class="flex items-center space-x-6 rtl:space-x-reverse">
        <button onclick="logout()" class="text-sm  text-blue-600 btn btn-danger">logout</button>
      </div>
    </div>
  </nav>
  <!--  -->

  <!-- heading  -->
  <div class="text-center mt-5">
    <h2 id="name" class="text-primary fw-bold" style="font-size:40px;">Welcome</h2>
    <p class="fw-bold" style="font-size: 20px;">Online Banking Service</p>
  </div>

  <div class="row justify-content-around mt-5">
    <!-- deposit -->
    <div class="card col-lg-3 col-md-12 p-3 shadow">
      <h5 class="text-primary fw-bold mb-4">Deposit</h5>
      <input type="number" class="form-control mb-2" placeholder="Amount" id="useramount">
      <input type="text" class="form-control mb-2" placeholder="Password" id="pass">
      <button class="btn btn-primary w-40 text-center mt-2" style="margin-left: 100px;"
        onclick="deposit()">Deposit</button>
      <p class="mt-3 text-primary" id="display_bal">Balance : $0</p>

    </div>
    <!-- withdraw -->

    <div class="card col-lg-3 col-md-12 p-3 shadow">
      <h5 class="text-primary fw-bold mb-4">Withdraw</h5>
      <input type="text" class="form-control mb-2" placeholder="Amount" id="withdrawamount">
      <input type="text" class="form-control mb-2" placeholder="Password" id="upi">
      <button class="btn btn-primary w-40 text-center mt-2" style="margin-left: 100px;"
        onclick="withdraw()">Withdraw</button>
      <p class="mt-3 text-primary" id="display_bal_withderaw">Balance : $0</p>

    </div>

 
  <!-- transaction History -->
  <div class="text-center mt-5  col-md-12 ">

    <div class="card p-3 shadow" >
      <h5 class="text-primary fw-bold mb-4 col-md-12">Transaction History</h5>

      <div id="transaction" class="col-md-12"> </div>


    </div>
  </div>
   </div>

  <script>

// TO SHOW NAME ON WELCOME
 
      let userid = sessionStorage.getItem("loggedUserId")
      let userdata = JSON.parse(localStorage.getItem(userid))
      // console.log(userdata.name);
      
        document.getElementById("name").innerHTML =
          `Welcome <span style="text-transform: uppercase;">${userdata.name}<span>`;

             document.getElementById("display_bal").innerHTML = `Balance : $${userdata.balance}`
        document.getElementById("display_bal_withderaw").innerHTML = `Balance : $${userdata.balance}`

//  to show transaction

let tran = userdata.transaction
console.log(tran);

          let tableHTML = `
  <table border="1" class="table table-striped class="col-md-12"">
    <thead>
      <tr>
        <th>Date & Time</th>
        <th>Type</th>
        <th>Amount</th>
        <th>Balance</th>
      </tr>
    </thead>
    <tbody>
`;

          // Loop through transactions and add rows
          tran.forEach(trx => {
            tableHTML += `
      <tr>
        <td>${trx.day}</td>
        <td>${trx.type}</td>
        <td>${trx.amount}</td>
        <td>${trx.balance}</td>
      </tr>
    `;
          });

          document.getElementById("transaction").innerHTML = tableHTML;






    // FUNCTION DEPOSIT

    function deposit() {

      let userid = sessionStorage.getItem("loggedUserId")
      // console.log(userid);
      let olddata = JSON.parse(localStorage.getItem(userid))


      // console.log(pass);

      // let upi_id= document.getElementById("upi")
      if (olddata.pass == pass.value) {

        let depamount = useramount.value
        let depamou = Number(depamount)
        olddata.balance += depamou
        localStorage.setItem(userid, JSON.stringify(olddata))
        //   console.log(typeof(olddata.balance));
        document.getElementById("display_bal").innerHTML = `Balance : $${olddata.balance}`
        document.getElementById("display_bal_withderaw").innerHTML = `Balance : $${olddata.balance}`




        //   current date & time
        let now = new Date()
        const hours = now.getHours();
        const minutes = now.getMinutes();
        const seconds = now.getSeconds();

        const date = now.getDate();
        const month = now.getMonth() + 1;
        const year = now.getFullYear();
        let dep_date_time = `${date}/${month}/${year},${hours}:${minutes}:${seconds}`
        //  console.log(dep_date_time);


        //    display transtation
        // transaction

        let transaction = {
          day: dep_date_time,
          type: "credit",
          amount: depamou,
          balance: olddata.balance
        }

        if (!olddata.transaction) {
          olddata.transaction = [];
        }

        olddata.transaction.push(transaction);

        localStorage.setItem(userid, JSON.stringify(olddata))

//  to show transaction

let tran = olddata.transaction
console.log(tran);

          let tableHTML = `
  <table border="1" class="table table-striped class="col-md-12"">
    <thead>
      <tr>
        <th>Date & Time</th>
        <th>Type</th>
        <th>Amount</th>
        <th>Balance</th>
      </tr>
    </thead>
    <tbody>
`;

          // Loop through transactions and add rows
          tran.forEach(trx => {
            tableHTML += `
      <tr>
        <td>${trx.day}</td>
        <td>${trx.type}</td>
        <td>${trx.amount}</td>
        <td>${trx.balance}</td>
      </tr>
    `;
          });

          document.getElementById("transaction").innerHTML = tableHTML;


 
     }
      else {
        alert("Wrong upi pin")
      }

    }






    // FUNCTION  WITHDRAW
    function withdraw() {
      let userid = sessionStorage.getItem("loggedUserId")
      // console.log(userid);
      let olddata = JSON.parse(localStorage.getItem(userid))
      // console.log(olddata);


      if (olddata.pass == upi.value) {

        if (olddata.balance > 0) {
          let withdrawamount1 = withdrawamount.value;
          let withdrawamo = Number(withdrawamount1)
          //   console.log(withdrawamo);
          olddata.balance -= withdrawamo
          localStorage.setItem(userid, JSON.stringify(olddata))
          //   console.log(typeof(olddata.balance));
          document.getElementById("display_bal_withderaw").innerHTML = `Balance : $${olddata.balance}`
          document.getElementById("display_bal").innerHTML = `Balance : $${olddata.balance}`

          //   current date & time
          let now = new Date()
          const hours = now.getHours();
          const minutes = now.getMinutes();
          const seconds = now.getSeconds();

          const date = now.getDate();
          const month = now.getMonth() + 1;
          const year = now.getFullYear();
          let dep_date_time = `${date}/${month}/${year},${hours}:${minutes}:${seconds}`
          //  console.log(dep_date_time);


          //    display transtation
          // transaction

          let transaction = {
            day: dep_date_time,
            type: "debit",
            amount: withdrawamount1,
            balance: olddata.balance
          }

          if (!olddata.transaction) {
            olddata.transaction = [];
          }

          olddata.transaction.push(transaction);

          localStorage.setItem(userid, JSON.stringify(olddata))
      document.getElementById("transaction").innerHTML =`<table>${transaction.day} ${transaction.type} ${transaction.amount} ${transaction.balance}</table>`     

       //  to show transaction

let tran = olddata.transaction
console.log(tran);

          let tableHTML = `
  <table border="1" class="table table-striped class="col-md-12"">
    <thead>
      <tr>
        <th>Date & Time</th>
        <th>Type</th>
        <th>Amount</th>
        <th>Balance</th>
      </tr>
    </thead>
    <tbody>
`;

          // Loop through transactions and add rows
          tran.forEach(trx => {
            tableHTML += `
      <tr>
        <td>${trx.day}</td>
        <td>${trx.type}</td>
        <td>${trx.amount}</td>
        <td>${trx.balance}</td>
      </tr>
    `;
          });

          document.getElementById("transaction").innerHTML = tableHTML;
        }
        else {
          alert("insufficient balance")
        }

      }
      else {
        alert("Wrong upi pin")
      }

    }


    function logout() {
      // let userid = sessionStorage.getItem("loggedUserId")
      sessionStorage.removeItem("loggedUserId");
      window.location.href = "./login.html"
    }


  </script>
</body>

</html>